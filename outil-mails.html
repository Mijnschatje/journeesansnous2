<!doctype html>
<html lang="fr">
<head>

  <link rel="stylesheet" href="assets/css/menu.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journ√©e Sans Nous ‚Äî G√©n√©rateur de mails aux syndicats</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <style>
    :root{--brand:#ee4943;--brand-600:#d33e38;--ink:#0f172a;--muted:#475569;--line:#e5e7eb;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 'Manrope',sans-serif;color:var(--ink);background:#fafafa}
    a{color:var(--brand);text-decoration:none}
    
    /* ===== HEADER ===== */
    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line);box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .wrap{max-width:1100px;margin:auto;padding:0 18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;height:64px;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--brand);font-size:18px}
    .site-title-link {
  text-decoration: none;
  color: inherit;
}

.site-title-link:hover {
  opacity: 0.8;
}

    /* ===== TICKER ===== */
    .ticker{background:var(--brand);color:#fff;overflow:hidden;white-space:nowrap;font-weight:600;font-size:14px}
    .ticker .track{display:inline-block;animation:scroll 60s linear infinite;padding:8px 0}
    @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

    /* ===== HERO ===== */
    .hero{background:linear-gradient(135deg,#fff 0%,#fff5f4 50%,#ffe8e6 100%);padding:60px 0;border-bottom:1px solid var(--line);position:relative;overflow:hidden}
    .hero::before{content:'';position:absolute;top:-50%;right:-10%;width:500px;height:500px;background:radial-gradient(circle,rgba(238,73,67,.1),transparent);border-radius:50%}
    .hero h1{color:var(--brand);font-size:clamp(28px,3.2vw,42px);line-height:1.2;margin:0;font-weight:800;display:flex;align-items:center;gap:14px}
    .hero .lede{color:var(--muted);margin:.6rem 0 0;font-size:17px}
    .step-num{display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;background:var(--brand);color:#fff;border-radius:50%;font-size:22px;font-weight:800;flex-shrink:0}
    
    /* Barre de progression */
    .progress-bar{background:#f1f5f9;height:8px;border-radius:999px;overflow:hidden;margin:20px 0}
    .progress-fill{background:linear-gradient(90deg,var(--brand),#ff6b6b);height:100%;transition:width .6s ease;border-radius:999px;position:relative}
    .progress-fill::after{content:'';position:absolute;top:0;right:0;bottom:0;width:30px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3));animation:shimmer 1.5s infinite}
    @keyframes shimmer{0%,100%{opacity:0}50%{opacity:1}}
    .progress-text{text-align:center;margin-top:8px;font-size:14px;font-weight:600;color:var(--brand)}
    
    main{max-width:900px;margin:auto;padding:24px 18px}
    
    .step-card{background:#fff;border:1px solid var(--line);border-radius:16px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.04);transition:box-shadow .2s}
    .step-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .step-head{display:flex;justify-content:space-between;align-items:center;padding:18px 20px;border-bottom:1px solid var(--line);background:#fafafa;border-radius:16px 16px 0 0}
    .step-head h2{margin:0;color:var(--brand);font-size:18px;display:flex;align-items:center;gap:10px}
    .step-num-small{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;background:var(--brand);color:#fff;border-radius:50%;font-size:14px;font-weight:800}
    .step-body{padding:20px}
    
    .form-group{margin-bottom:18px}
    .form-group:last-child{margin-bottom:0}
    label{display:block;font-weight:600;margin-bottom:6px;color:var(--ink);font-size:14px;display:flex;align-items:center;gap:8px}
    .field-check{display:none;color:#10b981;font-size:16px}
    .field-check.show{display:inline-block;animation:checkPop .3s ease}
    @keyframes checkPop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    .helper{color:var(--muted);font-size:13px;margin-top:4px;line-height:1.4}
    input,select,textarea{width:100%;padding:11px 13px;border:1px solid var(--line);border-radius:10px;background:#fff;outline:none;font-family:inherit;font-size:15px;transition:all .2s}
    input:focus,select:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(238,73,67,.1)}
    textarea{min-height:280px;resize:vertical;font-size:14px;line-height:1.6}
    select{cursor:pointer}
    
    .grid-2{display:grid;gap:14px;grid-template-columns:1fr}
    @media(min-width:680px){.grid-2{grid-template-columns:1fr 1fr}}
    
    .checkbox-group{display:flex;align-items:center;gap:10px;padding:12px;background:#f8f9fa;border-radius:10px;cursor:pointer;transition:background .2s}
    .checkbox-group:hover{background:#f1f3f5}
    .checkbox-group input[type="checkbox"]{width:auto;margin:0;cursor:pointer}
    .checkbox-group label{margin:0;cursor:pointer;font-weight:500}
    
    #mandat-details{display:none;margin-top:10px}
    #mandat-details.show{display:block}
    
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    @media(max-width:680px){.actions{flex-direction:column}}
    
    .note{border-left:4px solid var(--brand);background:#fff2f1;padding:12px 14px;border-radius:10px;font-size:14px;line-height:1.5;position:relative;overflow:hidden}
    .note::before{content:'üí°';position:absolute;top:8px;right:8px;font-size:20px;opacity:.3}
    .note strong{color:var(--brand)}
    
    .preview-box{white-space:pre-wrap;border:1px solid var(--line);border-radius:10px;padding:16px;background:#fafafa;font-size:14px;line-height:1.7;max-height:400px;overflow-y:auto;color:#334155}
    .preview-box.empty{color:var(--muted);font-style:italic;text-align:center;padding:40px 20px}
    
    .success-banner{background:#10b981;color:#fff;padding:12px 20px;border-radius:10px;display:none;align-items:center;gap:10px;margin-bottom:16px}
    .success-banner.show{display:flex}
    
  /* ===== FOOTER ===== */
  footer{background:#fdfdfd;border-top:1px solid #e5e7eb;color:#475569;padding:26px 18px;text-align:center}
  footer .footer-logo{max-width:140px;height:auto;vertical-align:middle;margin:0 8px}
    
    @media(max-width:680px){
      .topbar{height:auto;padding:12px 0}
      .step-head{flex-direction:column;align-items:flex-start;gap:12px}
      .step-head .actions{width:100%}
      .hero{padding:40px 0}
      /* ‚úÖ CORRECTION: R√©duire la marge √† gauche sur mobile */
      main{margin-top:0;padding-left:18px;padding-right:18px}
    }

  /* Boutons d'action (mail | copier | t√©l√©charger) */
  .actions{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    margin-top:16px;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:12px 18px;
    border-radius:12px;
    border:2px solid rgba(0,0,0,.08);
    background:#fff;
    color:#0f172a;               /* var(--ink) */
    font:600 15px/1 'Manrope', system-ui, sans-serif;
    cursor:pointer;
    text-decoration:none;
    transition:transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
  }
  .btn i{ font-size:15px; }

  .btn:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(0,0,0,.08);
    border-color:rgba(0,0,0,.12);
  }

  .btn:active{
    transform:translateY(0);
    box-shadow:0 3px 10px rgba(0,0,0,.06);
  }

  /* Variante principale (rouge JSN) */
  .btn.primary{
    background: var(--brand, #ee4943);
    color:#fff;
    border-color: var(--brand-600, #d33e38);
  }
  .btn.primary:hover{
    background: var(--brand-600, #d33e38);
    border-color: var(--brand-600, #d33e38);
    box-shadow:0 8px 24px rgba(238,73,67,.28);
  }

  /* Variante ‚Äúghost‚Äù si besoin  */
  .btn.ghost{
    background:transparent;
    color:var(--brand, #ee4943);
    border-color: rgba(238,73,67,.35);
  }
  .btn.ghost:hover{
    background: rgba(238,73,67,.06);
    border-color: rgba(238,73,67,.55);
  }
</style>

</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand"><span><a href="/" class="site-title-link">Journ√©e Sans Nous</a></span></div>
  </div>
</header>

  <div class="ticker"><div class="track">EN R√âGION PARISIENNE : lundi 17 novembre 19h‚Äì21h ‚ûú Assembl√©e publique ‚Äì Bourse du Travail, 29 Bd du Temple, 75011 Paris ‚Ä¢ tous les lundis 19h ‚ûú R√©union d'organisation ‚Äì 3 rue du Ch√¢teau d'Eau ‚Ä¢ √Ä L'√âCHELLE NATIONALE : jeudi 30 octobre 19h‚Äì21h ‚ûú R√©union en visio nationale des collectifs signataires de l'appel ‚Ä¢ EN R√âGION PARISIENNE : lundi 17 novembre 19h‚Äì21h ‚ûú Assembl√©e publique ‚Äì Bourse du Travail, 29 Bd du Temple, 75011 Paris ‚Ä¢ tous les lundis 19h ‚ûú R√©union d'organisation ‚Äì 3 rue du Ch√¢teau d'Eau</div></div>

  <section class="hero">
    <div class="wrap">
      <h1><span class="step-num">3</span> <span>Agir</span></h1>
      <p class="lede">G√©n√®re en 2 minutes un mail clair et percutant √† ton syndicat, ta f√©d√© ou ton UD pour rejoindre la mobilisation.</p>
    </div>
  </section>

  <main>
    <div>
      <!-- √âTAPE 1 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num-small">‚úî</span> Choisis ton syndicat</h2>
      </div>
      <div class="step-body">
        <div class="grid-2">
          <div class="form-group">
            <label for="syndicat">Syndicat * <span class="field-check" id="check-syndicat">‚úì</span></label>
            <select id="syndicat" required>
              <option value="">‚Äî S√©lectionner ‚Äî</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dept">D√©partement <span class="field-check" id="check-dept">‚úì</span></label>
            <select id="dept">
              <option value="">‚Äî Optionnel ‚Äî</option>
            </select>
            <div class="helper">Union D√©partementale de ton d√©partement</div>
          </div>
          <div class="form-group">
            <label for="fede">F√©d√©ration (secteur) <span class="field-check" id="check-fede">‚úì</span></label>
            <select id="fede">
              <option value="">‚Äî Optionnel ‚Äî</option>
            </select>
            <div class="helper">F√©d√©ration de ton secteur professionnel</div>
          </div>
          <div class="form-group">
            <label for="destinataire">Emails des destinataires * <span class="field-check" id="check-destinataire">‚úì</span></label>
            <input id="destinataire" type="text" placeholder="Les emails s'ajoutent automatiquement" required />
            <div class="helper">Les emails s√©lectionn√©s apparaissent ici</div>
          </div>
        </div>
        <div class="form-group" style="margin-top:10px">
          <label for="cc">Copie (CC - optionnel) <span class="field-check" id="check-cc">‚úì</span></label>
          <input id="cc" type="text" placeholder="Emails suppl√©mentaires en copie..." />
          <div class="helper">Les emails en surplus s'ajoutent ici</div>
        </div>
      </div>
    </div>

    <!-- √âTAPE 2 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num-small">‚úî</span> Ajoute tes informations</h2>
      </div>
      <div class="step-body">
        <div class="grid-2">
          <div class="form-group">
            <label for="nom">Nom / Pr√©nom * <span class="field-check" id="check-nom">‚úì</span></label>
            <input id="nom" placeholder="Ton nom ou collectif" required />
          </div>
          <div class="form-group">
            <label for="lieu">Ville / Lieu de travail * <span class="field-check" id="check-lieu">‚úì</span></label>
            <input id="lieu" placeholder="Paris 20e, entrep√¥t X..." required />
          </div>
        </div>
        
        <div class="form-group">
          <div class="checkbox-group" onclick="document.getElementById('hasMandat').click()">
            <input type="checkbox" id="hasMandat" onclick="event.stopPropagation()">
            <label for="hasMandat">J'ai un mandat syndical</label>
          </div>
          <div id="mandat-details">
            <input id="mandat" placeholder="Ex : d√©l√©gu√©¬∑e syndical¬∑e, √©lu¬∑e CSE..." style="margin-top:10px" />
            <div class="helper">Pr√©cise ton mandat pour renforcer ta l√©gitimit√©</div>
          </div>
        </div>
      </div>
    </div>

    <!-- √âTAPE 3 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num-small">‚úî</span> Personnalise le message</h2>
      </div>
      <div class="step-body">
        <div class="form-group">
          <label for="sujet">Objet de l'email <span class="field-check" id="check-sujet">‚úì</span></label>
          <input id="sujet" value="Appel √† la mobilisation du 18 d√©cembre ‚Äì Journ√©e Sans Nous : pour une gr√®ve solidaire et politique" />
        </div>
        
        <div class="form-group">
          <label for="message">Corps du message (modifiable si besoin)</label>
          <textarea id="message" placeholder="Le message se g√©n√®re automatiquement avec tes informations..."></textarea>
        </div>
        <div class="note">
          <strong>üí° Le message se remplit automatiquement</strong> avec tes informations. Tu peux le modifier directement dans la zone de texte si tu veux le personnaliser davantage.
        </div>
      </div>
    </div>

    <!-- √âTAPE 4 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num">‚úî</span> V√©rifie et envoie</h2>
      </div>
      <div class="step-body">
        <div class="form-group">
          <label>Aper√ßu du message</label>
          <div id="preview" class="preview-box empty">Charge le mod√®le pour voir l'aper√ßu...</div>
        </div>
        
        <div class="actions" style="margin-top:16px;display:flex;flex-direction:column;align-items:center;gap:12px">
          <button class="btn primary" id="btnMailto" style="width:100%;max-width:300px;justify-content:center">Envoyer le mail</button>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
            <button class="btn" id="btnCopier">üìã Copier</button>
            <button class="btn" id="btnTelecharger">üíæ T√©l√©charger</button>
          </div>
        </div>
        
        <div class="note" style="margin-top:12px">
          <strong>Comment √ßa marche :</strong><br>
          ‚Ä¢ <strong>"Envoyer le mail"</strong> : ouvre automatiquement ton application (Gmail, Outlook, etc.) avec tout pr√©-rempli<br>
          ‚Ä¢ <strong>"Copier"</strong> : copie le texte du mail<br>
          ‚Ä¢ <strong>"T√©l√©charger"</strong> : sauvegarde le message
        </div>
      </div>
    </div>
  </main>

<footer>
  <div>
    ¬© Journ√©e Sans Nous ‚Ä¢ Initiative de
    <a href="https://www.antiracisme-solidarite.org" target="_blank" rel="noreferrer noopener">
      <img src="assets/img/Marche_des_Solidarites_logo.svg" alt="Marche des Solidarit√©s" class="footer-logo">
    </a>
    ‚Ä¢ 2025
  </div>
</footer>

<script>
/* ===== Syst√®me de progression ===== */
function updateProgress(){
  const fields = {
    'syndicat': el('syndicat').value,
    'destinataire': el('destinataire').value,
    'nom': el('nom').value,
    'lieu': el('lieu').value,
    'sujet': el('sujet').value,
    'message': el('message').value
  };
  
  let completed = 0;
  const total = Object.keys(fields).length;
  
  // Compter les champs remplis
  Object.keys(fields).forEach(key => {
    if(fields[key] && fields[key].trim()){
      completed++;
      // Afficher la coche verte
      const check = document.getElementById(`check-${key}`);
      if(check) check.classList.add('show');
    } else {
      // Cacher la coche
      const check = document.getElementById(`check-${key}`);
      if(check) check.classList.remove('show');
    }
  });
  
  // G√©rer les champs optionnels avec coches
  ['dept', 'fede', 'cc'].forEach(key => {
    const val = el(key).value;
    const check = document.getElementById(`check-${key}`);
    if(check){
      if(val && val.trim()){
        check.classList.add('show');
      } else {
        check.classList.remove('show');
      }
    }
  });
  
  const percentage = Math.round((completed / total) * 100);
  
  // Mise √† jour responsive : width sur desktop, height sur mobile
  const isMobile = window.innerWidth <= 768;
  const progressBar = el('progressBar');
  
  if(isMobile){
    progressBar.style.height = percentage + '%';
    progressBar.style.width = '100%';
  } else {
    progressBar.style.width = percentage + '%';
    progressBar.style.height = '100%';
  }
  
  el('progressText').textContent = percentage + '% compl√©t√©';
  
  console.log(`Progression: ${completed}/${total} = ${percentage}%`);
}

/* ===== Animation confettis ===== */
function createConfetti(){
  const colors = ['#ee4943', '#fbbf24', '#3b82f6', '#10b981', '#f472b6', '#a78bfa'];
  const confettiCount = 50;
  
  for(let i = 0; i < confettiCount; i++){
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.setProperty('--confetti-color', colors[Math.floor(Math.random() * colors.length)]);
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.top = '-10px';
      confetti.style.opacity = '1';
      
      document.body.appendChild(confetti);
      
      const duration = 2000 + Math.random() * 1000;
      const rotation = Math.random() * 360;
      const drift = (Math.random() - 0.5) * 200;
      
      confetti.animate([
        { transform: 'translateY(0) rotate(0deg) translateX(0)', opacity: 1 },
        { transform: `translateY(${window.innerHeight + 20}px) rotate(${rotation}deg) translateX(${drift}px)`, opacity: 0 }
      ], {
        duration: duration,
        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
      }).onfinish = () => confetti.remove();
      
    }, i * 30);
  }
}

/* ===== Mapping d√©partements ===== */
const DEPTS={"01":"Ain","02":"Aisne","03":"Allier","04":"Alpes-de-Haute-Provence","05":"Hautes-Alpes","06":"Alpes-Maritimes","07":"Ard√®che","08":"Ardennes","09":"Ari√®ge","10":"Aube","11":"Aude","12":"Aveyron","13":"Bouches-du-Rh√¥ne","14":"Calvados","15":"Cantal","16":"Charente","17":"Charente-Maritime","18":"Cher","19":"Corr√®ze","2A":"Corse-du-Sud","2B":"Haute-Corse","21":"C√¥te-d'Or","22":"C√¥tes-d'Armor","23":"Creuse","24":"Dordogne","25":"Doubs","26":"Dr√¥me","27":"Eure","28":"Eure-et-Loir","29":"Finist√®re","30":"Gard","31":"Haute-Garonne","32":"Gers","33":"Gironde","34":"H√©rault","35":"Ille-et-Vilaine","36":"Indre","37":"Indre-et-Loire","38":"Is√®re","39":"Jura","40":"Landes","41":"Loir-et-Cher","42":"Loire","43":"Haute-Loire","44":"Loire-Atlantique","45":"Loiret","46":"Lot","47":"Lot-et-Garonne","48":"Loz√®re","49":"Maine-et-Loire","50":"Manche","51":"Marne","52":"Haute-Marne","53":"Mayenne","54":"Meurthe-et-Moselle","55":"Meuse","56":"Morbihan","57":"Moselle","58":"Ni√®vre","59":"Nord","60":"Oise","61":"Orne","62":"Pas-de-Calais","63":"Puy-de-D√¥me","64":"Pyr√©n√©es-Atlantiques","65":"Hautes-Pyr√©n√©es","66":"Pyr√©n√©es-Orientales","67":"Bas-Rhin","68":"Haut-Rhin","69":"Rh√¥ne","70":"Haute-Sa√¥ne","71":"Sa√¥ne-et-Loire","72":"Sarthe","73":"Savoie","74":"Haute-Savoie","75":"Paris","76":"Seine-Maritime","77":"Seine-et-Marne","78":"Yvelines","79":"Deux-S√®vres","80":"Somme","81":"Tarn","82":"Tarn-et-Garonne","83":"Var","84":"Vaucluse","85":"Vend√©e","86":"Vienne","87":"Haute-Vienne","88":"Vosges","89":"Yonne","90":"Territoire de Belfort","91":"Essonne","92":"Hauts-de-Seine","93":"Seine-Saint-Denis","94":"Val-de-Marne","95":"Val-d'Oise","971":"Guadeloupe","972":"Martinique","973":"Guyane","974":"La R√©union","975":"Saint-Pierre-et-Miquelon","976":"Mayotte","977":"Saint-Barth√©lemy","978":"Saint-Martin","986":"Wallis-et-Futuna","987":"Polyn√©sie fran√ßaise","988":"Nouvelle-Cal√©donie"};

/* ===== Chargement de la base JSON ===== */
let DB={
  "CFDT": {"national": "paris@sgen.cfdt.fr", "ud": [], "fede": []},
  "CFTC": {"national": "organisation@cftc.fr", "ud": [], "fede": []},
  "Solidaires": {"national": "contact@solidaires.org", "ud": [], "fede": []},
  "CGT-FO": {"national": "secretariatnego@force-ouvriere.fr", "ud": [], "fede": []},
  "CFE-CGC": {"national": "pap@cfecgc.fr", "ud": [], "fede": []},
  "CGT": {"national": "site@cgt.org", "ud": [], "fede": []},
  "UNSA": {"national": null, "ud": [], "fede": []}
};

async function loadDB(){
  // Essayer plusieurs chemins possibles
  const urls = [
    'data/emails-syndicats.json',
    './data/emails-syndicats.json',
    '../data/emails-syndicats.json',
    '/journeesansnous/data/emails-syndicats.json',
    'https://mijnschatje.github.io/journeesansnous/data/emails-syndicats.json'
  ];
  
  for(const url of urls){
    try{
      console.log('üîç Tentative de chargement:', url);
      const r = await fetch(url, {cache:'no-store'});
      if(r.ok){
        const data = await r.json();
        DB = data;
        console.log('‚úÖ BASE CHARG√âE depuis:', url);
        console.log('üìä Syndicats:', Object.keys(DB));
        
        // V√©rifier qu'on a bien des donn√©es
        Object.keys(DB).forEach(synd => {
          console.log(`  ${synd}: ${(DB[synd].ud||[]).length} d√©partements, ${(DB[synd].fede||[]).length} f√©d√©rations`);
        });
        
        fillSyndicats();
        return true;
      }
    }catch(e){
      console.log('‚ùå √âchec pour:', url, '-', e.message);
    }
  }
  
  console.warn('‚ö†Ô∏è ATTENTION: Impossible de charger la base de donn√©es');
  console.warn('üìÅ Assure-toi que le fichier emails-syndicats.json est dans un dossier "data/"');
  fillSyndicats();
  return false;
}

/* ===== Helpers ===== */
const el=id=>document.getElementById(id);

function fillSyndicats(){
  const s=el('syndicat'); 
  s.innerHTML='<option value="">‚Äî S√©lectionner ‚Äî</option>';
  const keys=Object.keys(DB).sort();
  console.log('Remplissage syndicats:', keys);
  keys.forEach(k=>s.add(new Option(k,k)));
  fillStructures();
}

function udSortKey(x){
  const c=(x.code||'').toUpperCase();
  const m=c.match(/^(\d+)([A-Z]?)$/);
  if(!m) return [9999,c];
  const n=parseInt(m[1],10);
  const frac=m[2]==='A'?0.1:(m[2]==='B'?0.2:0);
  return [n+frac,c];
}

function fillStructures(){
  const synd=el('syndicat').value;
  const dept=el('dept'); 
  const fede=el('fede');
  
  // Vider les selects
  dept.innerHTML='<option value="">‚Äî Optionnel ‚Äî</option>';
  fede.innerHTML='<option value="">‚Äî Optionnel ‚Äî</option>';

  if(!synd){
    console.log('‚ùå Aucun syndicat s√©lectionn√©');
    updateEmail();
    return;
  }

  const rec = DB[synd] || {};
  console.log('üìã Syndicat s√©lectionn√©:', synd);
  console.log('üìä Donn√©es brutes:', rec);
  
  const fedeList = rec.fede || [];
  const udList = rec.ud || [];
  
  console.log(`üì¶ Nombre de f√©d√©rations: ${fedeList.length}`);
  console.log(`üì¶ Nombre de d√©partements: ${udList.length}`);

  // Remplir les f√©d√©rations
  if(fedeList.length > 0) {
    fedeList.forEach((x, index) => {
      const label = x.label || `F√©d√©ration ${index+1}`;
      const email = x.email || '';
      console.log(`  ‚ûï F√©d√© ${index+1}: ${label} ‚Üí ${email}`);
      fede.add(new Option(label, email));
    });
    console.log(`‚úÖ ${fedeList.length} f√©d√©rations ajout√©es`);
  } else {
    console.log('‚ö†Ô∏è Aucune f√©d√©ration disponible');
  }

  // Remplir les d√©partements (tri√©s)
  if(udList.length > 0) {
    const sortedUDs = udList.slice().sort((a,b) => {
      const [an, ac] = udSortKey(a);
      const [bn, bc] = udSortKey(b);
      return an - bn || ac.localeCompare(bc);
    });
    
    sortedUDs.forEach((x, index) => {
      const code = x.code || '';
      const email = x.email || '';
      const deptName = DEPTS[code] || '';
      const nice = (code && deptName) ? `${code} ‚Äì ${deptName}` : (x.label || code || `UD ${index+1}`);
      console.log(`  ‚ûï D√©pt ${index+1}: ${nice} ‚Üí ${email}`);
      dept.add(new Option(nice, email));
    });
    console.log(`‚úÖ ${sortedUDs.length} d√©partements ajout√©s`);
  } else {
    console.log('‚ö†Ô∏è Aucun d√©partement disponible');
  }

  console.log(`üéØ Remplissage termin√© - Select F√©d√©: ${fede.options.length} options, Select D√©pt: ${dept.options.length} options`);
  updateEmail();
}

function updateEmail(){
  const synd = el('syndicat').value;
  const deptVal = el('dept').value || '';
  const fedeVal = el('fede').value || '';
  
  if(!synd) {
    el('destinataire').value = '';
    el('cc').value = '';
    return;
  }
  
  const national = (DB[synd] || {}).national || '';
  
  // Collecter tous les emails s√©lectionn√©s
  const emails = [];
  
  // Ajouter dans l'ordre : National ‚Üí D√©partement ‚Üí F√©d√©ration
  if (national) emails.push(national);
  if (deptVal) emails.push(deptVal);
  if (fedeVal) emails.push(fedeVal);
  
  console.log('Emails collect√©s:', emails);
  
  // R√©partir les emails : le premier dans "destinataire", les autres dans "cc"
  if (emails.length > 0) {
    el('destinataire').value = emails[0];
    if (emails.length > 1) {
      el('cc').value = emails.slice(1).join(', ');
    } else {
      el('cc').value = '';
    }
  } else {
    el('destinataire').value = '';
    el('cc').value = '';
  }
  
  console.log('Destinataire:', el('destinataire').value);
  console.log('CC:', el('cc').value);
}

/* ===== G√©n√©ration du mod√®le ===== */
function MODELE_OFFICIEL(){
  const nom=(el('nom').value||'').trim() || '[Pr√©nom Nom]';
  const lieu=(el('lieu').value||'').trim() || '[Ville / Lieu de travail / √âtablissement]';
  const hasMandat=el('hasMandat').checked;
  const mandat=hasMandat ? (el('mandat').value||'').trim() : '';
  
  // Construction de la phrase selon le mandat
  let phraseMobilisation;
  if (hasMandat && mandat) {
    phraseMobilisation = `En tant que ${mandat}, je souhaite que mon lieu de travail puisse se joindre √† cette mobilisation historique.`;
  } else {
    phraseMobilisation = `Je souhaite que mon lieu de travail puisse se joindre √† cette mobilisation historique.`;
  }
  
  // Signature avec mandat si applicable
  let signature = `${nom}\n${lieu}`;
  if (hasMandat && mandat) {
    signature += `\nMandat : ${mandat}`;
  }
  
  return `Bonjour,

Je vous √©cris dans le cadre de la Journ√©e Sans Nous ‚Äì "Si on s'arr√™te, tout s'arr√™te !", organis√©e le 18 d√©cembre 2025, √† l'occasion de la Journ√©e internationale des migrant¬∑e¬∑s.

√Ä l'initiative des collectifs de personnes sans papiers, la Marche des Solidarit√©s appelle √† une gr√®ve g√©n√©rale solidaire √† l'√©chelle nationale.
üëâ L'appel complet : https://www.antiracisme-solidarite.org/18-d%C3%A9cembre-2025-journee-sans-nous

${phraseMobilisation}

Cette journ√©e d'action me permettra de m'exprimer en solidarit√© avec les personnes immigr√©es et sans papiers, qui sont mes ami¬∑es, mes voisin¬∑es et mes coll√®gues ‚Äî celles et ceux qui font tourner le pays mais restent priv√©¬∑es de droits, exploit√©¬∑es dans des conditions indignes et constamment discrimin√©¬∑es.

Aujourd'hui, les politiques racistes et inhumaines men√©es par l'√âtat (rafles, enfermements en CRA, durcissement des lois sur l'immigration, atteintes aux droits sociaux) ne sont pas seulement une attaque contre les personnes √©trang√®res : elles fragilisent tout le socle social en remettant en cause le droit du travail, en banalisant le travail dissimul√© et l'exploitation humaine, en organisant une mise en concurrence destructrice entre salari√©¬∑es, et en affaiblissant la solidarit√© collective.

Face √† cette urgence, nous avons besoin que les syndicats prennent position et ouvrent la voie √† une gr√®ve politique et solidaire.

üëâ Je vous demande :

‚Ä¢ de vous prononcer publiquement en faveur de la Journ√©e Sans Nous,
‚Ä¢ d'informer vos adh√©rent¬∑es et salari√©¬∑es sur la possibilit√© de se mobiliser le 18 d√©cembre,
‚Ä¢ et de mettre en ≈ìuvre les moyens l√©gaux pour permettre une gr√®ve solidaire (pr√©avis, communication, appui logistique‚Ä¶).

Cette journ√©e sera l'occasion de manifester, d√©battre, fermer symboliquement nos lieux de travail, pour rappeler que la solidarit√© n'a pas de papiers.

Merci pour votre √©coute et pour l'engagement que vous prendrez.
Je reste √† votre disposition pour toute information compl√©mentaire.

Solidairement,

${signature}
`;}

const MODELE_PREAVIS="Pour la Journ√©e Sans Nous √† l'occasion de la Journ√©e internationale des Migrant.e.s 2025, nous appelons √† une journ√©e de gr√®ve pour exiger [revendication professionnelle claire, ex : r√©gularisation par le travail / fin des contr√¥les discriminatoires / protection juridique pour travailleur¬∑ses migrant¬∑es] et pour d√©noncer le racisme d'√âtat qui nie ces droits.";

/* ===== Actions ===== */
function chargerModele(){
  el('message').value=MODELE_OFFICIEL();
  apercu();
  showSuccess();
}

function apercu(){
  const msg=el('message').value;
  const prev=el('preview');
  if(msg){
    prev.textContent=msg;
    prev.classList.remove('empty');
  }else{
    prev.textContent='Aucun message saisi.';
    prev.classList.add('empty');
  }
}

function copier(){
  const msg=el('message').value;
  if(!msg){alert('Charge d\'abord le mod√®le !');return;}
  navigator.clipboard.writeText(msg).then(()=>alert('‚úÖ Message copi√© dans le presse-papiers !'));
}

function toMailto(){
  const to=el('destinataire').value||'';
  if(!to){alert('‚ö†Ô∏è Indique au moins un email destinataire !');return;}
  
  const cc=el('cc').value||'';
  const sujet=el('sujet').value||'Appel √† la mobilisation du 18 d√©cembre';
  const body=el('message').value||MODELE_OFFICIEL();
  const enc=s=>encodeURIComponent(s).replace(/%0A/g,'%0D%0A');
  
  // Construction de l'URL mailto avec gestion des multiples destinataires
  let url = `mailto:${encodeURIComponent(to)}?subject=${enc(sujet)}&body=${enc(body)}`;
  if(cc){
    url += `&cc=${encodeURIComponent(cc)}`;
  }
  
  // Animation confettis !
  createConfetti();
  
  // Petit d√©lai pour voir les confettis avant d'ouvrir le mail
  setTimeout(() => {
    window.location.href=url;
  }, 500);
}

function telecharger(){
  const msg=el('message').value||MODELE_OFFICIEL();
  const blob=new Blob([msg],{type:'text/plain;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='mail-syndicat-journee-sans-nous.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

/* ===== Event listeners ===== */
document.addEventListener('DOMContentLoaded',()=>{
  // Boutons
  el('btnCopier').onclick=copier;
  el('btnMailto').onclick=toMailto;
  el('btnTelecharger').onclick=telecharger;
  
  // Selects
  el('syndicat').onchange=fillStructures;
  el('dept').onchange=updateEmail;
  el('fede').onchange=updateEmail;
  
  // Mandat toggle
  el('hasMandat').onchange=e=>{
    el('mandat-details').classList.toggle('show',e.target.checked);
    chargerModele(); // Reg√©n√®re le message
  };
  
  // Aper√ßu auto + r√©g√©n√©ration intelligente du message
  el('message').oninput=apercu;
  el('nom').oninput=chargerModele;
  el('lieu').oninput=chargerModele;
  el('mandat').oninput=chargerModele;
  
  // Init
  loadDB();
  chargerModele();
});
</script>
  <!-- Bouton de partage √Ä ajouter juste avant </body> -->
<button class="share-button" id="shareButton">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="18" cy="5" r="3"></circle>
    <circle cx="6" cy="12" r="3"></circle>
    <circle cx="18" cy="19" r="3"></circle>
    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
  </svg>
  <span>Partager</span>
</button>

<style>
.share-button {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 9999;
  background: #ee4943;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Manrope', sans-serif;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(238, 73, 67, 0.4);
  transition: all 0.3s ease;
}

.share-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(238, 73, 67, 0.6);
  background: #d33e38;
}

.share-button:active {
  transform: translateY(0);
}

.share-button svg {
  width: 20px;
  height: 20px;
}

@media (max-width: 768px) {
  .share-button {
    bottom: 16px;
    right: 16px;
    padding: 10px 16px;
    font-size: 13px;
  }
  
  .share-button svg {
    width: 18px;
    height: 18px;
  }
}
</style>

<script>
document.getElementById('shareButton').addEventListener('click', function() {
  const shareText = "18 d√©cembre 2025, Journ√©e Internationale des Migrant.e.s, mettons-nous en gr√®ve solidaire avec les personnes sans papiers pour agir contre les lois racistes et les discriminations ‚ûú JOURN√âE SANS NOUS, Si on s'arr√™te, tout s'arr√™te !";
  const shareUrl = window.location.href;
  
  if (navigator.share) {
    // API native de partage (mobile)
    navigator.share({
      title: 'Journ√©e Sans Nous - 18 d√©cembre 2025',
      text: shareText,
      url: shareUrl
    }).catch(err => console.log('Partage annul√©'));
  } else {
    // Fallback : copier dans le presse-papier
    const fullText = shareText + '\n\n' + shareUrl;
    navigator.clipboard.writeText(fullText).then(() => {
      // Feedback visuel
      const btn = document.getElementById('shareButton');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg><span>Copi√© !</span>';
      setTimeout(() => {
        btn.innerHTML = originalText;
      }, 2000);
    });
  }
});
</script>

  <script src="js/menu.js"></script>
  
</body>
</html>
